{% extends "base/base.html" %}
{% block css_file %}
    <link rel="stylesheet" href="/css/market_bp.css">
{% endblock %}
{% block title %} Hormarket {% endblock %}
{% block content %}
    <!-- Vid√©o de fond -->
    <video autoplay muted loop id="background-video">
        <source src="/media/vid1.mp4" type="video/mp4">
        Votre navigateur ne supporte pas la vid√©o.
    </video>
    <div class="overlay"></div>

    <!-- Overlay du panier -->
    <div class="cart-overlay" id="cart-overlay">
        <div class="cart-modal">
            <div class="cart-modal-header">
                <div class="cart-modal-title">
                    <span>üõí</span>
                    Mon Panier
                </div>
                <button class="close-cart" id="close-cart">‚úï</button>
            </div>
            
            <div class="cart-content">
                <div class="cart-items-container" id="cart-items-large">
                    <!-- Les articles du panier seront affich√©s ici -->
                    <div class="empty-cart-large" id="empty-cart-large">
                        Votre panier est vide. Ajoutez des produits pour commencer vos achats.
                    </div>
                </div>
            </div>
            
            <div class="cart-total-large" id="cart-total-large" style="display: none;">
                <span>Total:</span>
                <span id="cart-total-amount-large">0 MAD</span>
            </div>
            
            <button class="checkout-btn-large" id="checkout-btn-large" disabled>Confirmer l'achat</button>
        </div>
    </div>

    <!-- Recu (Re√ßu) -->
    <div class="receipt-overlay" id="receipt-overlay">
        <div class="receipt" id="receipt">
            <div class="receipt-header">
                <div class="receipt-title">HorMarket</div>
                <div class="receipt-date" id="receipt-date">15 Mars 2025</div>
            </div>
            
            <div class="receipt-items" id="receipt-items">
                <!-- Les articles achet√©s seront affich√©s ici -->
            </div>
            
            <div class="receipt-total">
                <span>Total:</span>
                <span id="receipt-total">0 MAD</span>
            </div>
            
            <div class="receipt-footer">
                Merci pour votre achat!<br>
                √Ä bient√¥t chez HorMarket
            </div>
            
            <button class="close-receipt" id="close-receipt">Fermer</button>
        </div>
    </div>

    <!-- Conteneur principal -->
    <div class="container">
        <!-- Barre lat√©rale compacte -->
        <div class="sidebar">
            <!-- En-t√™te de la barre lat√©rale -->
            <div class="sidebar-header">
                <div class="logo">HM</div>
                <div>
                    <div class="store-name">HorMarket</div>
                    <div class="year-badge">2025</div>
                </div>
            </div>

            <!-- Section du panier -->
            <div class="cart-section">
                <div class="cart-header" id="cart-toggle">
                    <div class="cart-icon-container">
                        <div class="cart-icon">üõí</div>
                        <div class="cart-indicator" id="cart-indicator">0</div>
                    </div>
                    <div class="cart-info">
                        <div class="cart-title">Mon Panier</div>
                        <div class="cart-count" id="cart-count">0 articles</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contenu principal -->
        <div class="main-content">
            <!-- En-t√™te du contenu principal -->
            <div class="main-header">
                <h1 class="page-title" id="current-page-title">Nos Produits</h1>
                
                <div class="user-menu">
                    <a href="#" class="commands-link" data-page="commandes">
                        <span>üìã</span>
                        Mes Commandes
                    </a>
                    
                    <div class="user-info-compact" id="user-menu-toggle">
                        <div class="user-avatar-small"></div>
                        <div class="user-details">
                            <div class="user-name">{{ username }}</div>
                            <div class="user-role">Client</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page des produits -->
            <div class="page active" id="produits">
                <div class="search-filter-bar">
                    <div class="search-container">
                        <input type="text" class="search-input" id="search-input" placeholder="Rechercher un produit...">
                        <button class="search-btn" id="search-btn">üîç</button>
                    </div>
                    
                    <div class="filter-container">
                        <div class="custom-select-wrapper">
                            <select class="filter-select" id="category-filter">
                                <option value="all">Toutes les cat√©gories</option>
                                <option value="Fruits">Fruits</option>
                                <option value="L√©gumes">L√©gumes</option>
                                <option value="Produits Laitiers">Produits Laitiers</option>
                                <option value="√âpicerie">√âpicerie</option>
                            </select>
                            <div class="custom-arrow">‚ñº</div>
                        </div>
                        
                        <div class="custom-select-wrapper">
                            <select class="filter-select" id="sort-filter">
                                <option value="name">Trier par nom</option>
                                <option value="price-asc">Prix croissant</option>
                                <option value="price-desc">Prix d√©croissant</option>
                                <option value="stock">Stock disponible</option>
                            </select>
                            <div class="custom-arrow">‚ñº</div>
                        </div>
                    </div>
                </div>

                <div class="products-grid" id="products-container">
                    <div class="product-card">
                    <div class="product-image"><img src=""></div>
                    <div class="product-name">x</div>
                    <div class="product-description">y</div>
                    <div class="product-price">0 MAD</div>
                    <div class="product-stock">10</div>
                    <div class="product-actions">
                        <div class="quantity-selector">
                            <button class="quantity-btn minus" data-id="${product.product_id}">-</button>
                            <input type="text" class="quantity-input" value="1" data-id="${product.product_id}">
                            <button class="quantity-btn plus" data-id="${product.product_id}">+</button>
                        </div>
                        <button class="add-to-cart-btn" data-id="${product.product_id}" ${product.current_stock_quantity === 0 ? 'disabled' : ''}>
                            ${product.current_stock_quantity === 0 ? 'Rupture' : 'Ajouter'}
                        </button>
                    </div>
                    </div>
                </div>
            </div>

            <!-- Page des commandes -->
            <div class="page" id="commandes">
                <div class="commands-container">
                    <h2 style="margin-bottom: 10px;">Historique de Mes Commandes</h2>
                    <p style="color: var(--gris-tres-clair); margin-bottom: 20px;">Consultez l'√©tat de toutes vos commandes pass√©es</p>
                    
                    <table class="commands-table">
                        <thead>
                            <tr>
                                <th>ID Commande</th>
                                <th>Date</th>
                                <th>Produit</th>
                                <th>Quantit√©</th>
                                <th>Prix Unitaire</th>
                                <th>Total</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody id="orders-table">
                            <!-- Les commandes seront charg√©es ici -->
                        </tbody>
                    </table>
                </div>
            </div>

            <footer>
                HorMarket - Boutique en Ligne 2025 ¬© 2025
            </footer>
        </div>
    </div>

    <script type="module" src="/js/market_bp.js"></script>

{% endblock %}